<div ng-show="analyses[index].isLoading()" class="md-margin">
  <md-progress-linear md-mode="indeterminate"></md-progress-linear>
</div>

<div class="md-margin md-whiteframe-z1">
  <md-toolbar>
    <div class="md-toolbar-tools">
      <md-button class="md-icon-button" aria-label="Analyse précédente" ng-click="prev()" ng-disabled="!hasPrev()">
        <md-icon md-svg-icon="navigation:arrow_back"></md-icon>
      </md-button>

      <md-button ng-disabled="!analyses[index]" class="md-icon-button" aria-label="Liste des analyses" ng-click="back()">
        <md-icon md-svg-icon="action:list"></md-icon>
      </md-button>

      <md-button class="md-icon-button" aria-label="Analyse suivante" ng-click="next()" ng-disabled="!hasNext()">
        <md-icon md-svg-icon="navigation:arrow_forward"></md-icon>
      </md-button>

      <span flex></span>

      <div ng-if="auth.isAuthorized()">
        <md-button ng-disabled="!analyses[index].isDirty()" class="md-icon-button" aria-label="Sauvegarder l'analyse" ng-click="save(analyses[index])">
          <md-tooltip md-direction="bottom" md-autohide>Sauvegarder l'analyse</md-tooltip>
          <md-icon md-svg-icon="content:save"></md-icon>
        </md-button>

        <md-button ng-disabled="!analyses[index]" class="md-icon-button" aria-label="Supprimer l'analyse" ng-click="remove(analyses[index])">
          <md-tooltip md-direction="bottom" md-autohide>Supprimer l'analyse</md-tooltip>
          <md-icon md-svg-icon="action:delete"></md-icon>
        </md-button>

        <md-button class="md-icon-button" aria-label="Nouvelle analyse" ng-click="newAnalysis()">
          <md-tooltip md-direction="bottom" md-autohide>Nouvelle analyse</md-tooltip>
          <md-icon md-svg-icon="content:add"></md-icon>
        </md-button>
      </div>
    </div>
  </md-toolbar>

  <md-content ng-hide="analyses[index]" class="whitesmoke md-padding">
    <md-list>
      <md-list-item ng-repeat="a in analyses track by $index">
        <button class="md-no-style md-button md-default-theme" ng-click="select($index)">
          <div class="md-list-item-text" ng-bind="a.title"></div>
        </button>
      </md-list-item>
    </md-list>
  </md-content>

  <div ng-if="analyses[index]">
    <md-tabs md-dynamic-height md-stretch-tabs="always" md-swipe-content md-border-bottom>
      <md-tab label="General">
        <md-content class="whitesmoke md-padding">
          <md-input-container>
            <label>Titre</label>
            <input type="text" ng-model="analyses[index].title" ng-change="analyses[index].setDirty(true)">
          </md-input-container>

          <div layout="row" layout-align="start center">
            <md-input-container flex>
              <label>URL</label>
              <input type="text" ng-model="analyses[index].url" ng-change="analyses[index].setDirty(true)">
            </md-input-container>

            <md-button aria-label="Accéder à l'URL" ng-href="{{ analyses[index].url }}" ng-disabled="!analyses[index].url" target="_blank">
              <md-tooltip md-direction="bottom" md-autohide>Accéder à l'URL</md-tooltip>
              Visiter
            </md-button>
          </div>

          <div layout="row" layout-wrap>
            <md-input-container flex-sm="50">
              <label>Type</label>
              <md-select ng-model="analyses[index].rtype" ng-change="analyses[index].setDirty(true)">
                <md-option></md-option>
                <md-option value="abstract">Résumé</md-option>
                <md-option value="article">Article</md-option>
                <md-option value="book">Book</md-option>
                <md-option value="book_section">Book section</md-option>
              </md-select>
            </md-input-container>

            <md-input-container flex-sm="50">
              <label>Mime</label>
              <md-select ng-model="analyses[index].mime" ng-change="analyses[index].setDirty(true)">
                <md-option></md-option>
                <md-option value="pdf">PDF</md-option>
                <md-option value="html">HTML</md-option>
                <md-option value="misc">MISC</md-option>
              </md-select>
            </md-input-container>

            <md-input-container flex>
              <label>UnitID</label>
              <input type="text" ng-model="analyses[index].unitid" ng-change="analyses[index].setDirty(true)">
            </md-input-container>
          </div>

          <md-chips ng-model="analyses[index].identifiers" placeholder="Entrer un identifiant" delete-button-label="Supprimer l'identifiant" secondary-placeholder="Identifiants" ng-change="analyses[index].setDirty(true)"></md-chips>
        </md-content>
      </md-tab>

      <md-tab label="URL en détail">
        <md-content class="whitesmoke md-padding">
          <div layout="row" layout-sm="column">
            <md-input-container flex>
              <label>URL</label>
              <input type="text" ng-model="analyses[index].url" ng-change="analyses[index].setDirty(true)">
            </md-input-container>

            <div layout="row" layout-align="center center">
              <md-button aria-label="Démembrer l'URL" ng-click="analyses[index].parseUrl()" ng-disabled="!analyses[index].url">
                <md-tooltip md-direction="bottom" md-autohide>Démembrer l'url</md-tooltip>
                Démembrer
              </md-button>

              <md-button aria-label="Accéder à l'URL" ng-href="{{ analyses[index].url }}" ng-disabled="!analyses[index].url" target="_blank">
                <md-tooltip md-direction="bottom" md-autohide>Accéder à l'URL</md-tooltip>
                Visiter
              </md-button>
            </div>
          </div>

          <h2 class="md-headline">Paramètres du path</h2>
          <div layout="row" layout-align="center center" class="fade-left parameter white md-whiteframe-z1 md-padding md-margin" layout-wrap ng-repeat="path in analyses[index].pathParams">
            <md-input-container flex="25" flex-sm="50">
              <label>Path</label>
              <input type="text" ng-model="path.value" ng-change="analyses[index].setDirty(true)">
            </md-input-container>

            <md-input-container flex>
              <label>Commentaire</label>
              <textarea ng-model="path.comment" ng-change="analyses[index].setDirty(true)"></textarea>
            </md-input-container>

            <md-button class="md-icon-button md-raised" aria-label="Supprimer un paramètre du path" ng-click="removeParam(analyses[index], 'path', $index)">
              <md-icon md-svg-icon="action:delete"></md-icon>
            </md-button>
          </div>

          <div layout="row" layout-align="center center">
            <md-button class="md-fab md-mini" aria-label="Ajouter un paramètre du path" ng-click="addParam(analyses[index], 'path')">
              <md-icon md-svg-icon="content:add"></md-icon>
            </md-button>
          </div>


          <h2 class="md-headline">Paramètres de la query</h2>
          <div layout="row" layout-align="center center" class="fade-left parameter white md-whiteframe-z1 md-padding md-margin" layout-wrap ng-repeat="query in analyses[index].queryParams">
            <md-input-container flex="25" flex-sm="50">
              <label>Nom</label>
              <input type="text" ng-model="query.name" ng-change="analyses[index].setDirty(true)">
            </md-input-container>

            <md-input-container flex="25" flex-sm="50">
              <label>Valeur</label>
              <input type="text" ng-model="query.value" ng-change="analyses[index].setDirty(true)">
            </md-input-container>

            <md-input-container flex>
              <label>Commentaire</label>
              <textarea ng-model="query.comment" ng-change="analyses[index].setDirty(true)"></textarea>
            </md-input-container>

            <md-button class="md-icon-button md-raised" aria-label="Supprimer un paramètre de la query" ng-click="removeParam(analyses[index], 'query', $index)">
              <md-icon md-svg-icon="action:delete"></md-icon>
            </md-button>
          </div>

          <div layout="row" layout-align="center center">
            <md-button class="md-fab md-mini" aria-label="Ajouter un paramètre de la query" ng-click="addParam(analyses[index], 'query')">
              <md-icon md-svg-icon="content:add"></md-icon>
            </md-button>
          </div>
        </md-content>
      </md-tab>

      <md-tab>
        <md-tab-label>
          Remarques <md-icon ng-show="analyses[index].comment" md-svg-icon="communication:comment"></md-icon>
        </md-tab-label>
        <md-content class="whitesmoke md-padding">
          <md-input-container>
            <label>Remarques</label>
            <textarea ng-model="analyses[index].comment" ng-change="analyses[index].setDirty(true)"></textarea>
          </md-input-container>
        </md-content>
      </md-tab>
    </md-tabs>
  </div>
</div>

<div layout="row" layout-align="center center" layout-wrap>
  <a href="javascript:void(0)" title="{{ a.title }}" ng-click="select($index)" ng-repeat="a in analyses track by $index">
    <md-icon md-svg-icon="image:{{ index == $index ? 'lens' : 'panorama_fish_eye' }}"></md-icon>
  </a>
</div>